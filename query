-- INSERT
-- insert new good
-- INSERT INTO goods ("name", "priority") VALUES ('new good', 1.5);

-- insert new sale
-- INSERT INTO sales ("good_id", "good_count", "create_date") VALUES ((SELECT ("id") FROM goods WHERE goods.name = 'new good'), 1, CURRENT_DATE);

-- add new good,add some amount to w1 and w2
-- BEGIN;
-- 	INSERT INTO goods ("name", "priority") VALUES ('new new good', 3);
-- 	INSERT INTO warehouse1 ("good_id", "good_count") VALUES ((SELECT ("id") FROM goods WHERE goods.name = 'new new good'), 3);
-- 	INSERT INTO warehouse2 ("good_id", "good_count") VALUES ((SELECT ("id") FROM goods WHERE goods.name = 'new new good'), 5);
-- 	COMMIT;
-- END;

-- add new good,add some amount to w1 and w2 check w1
DO
$do$
BEGIN
	INSERT INTO goods ("name", "priority") VALUES ('latest good', 3);
	INSERT INTO warehouse1 ("good_id", "good_count") VALUES ((SELECT ("id") FROM goods WHERE goods.name = 'latest good'), 3);
	INSERT INTO warehouse2 ("good_id", "good_count") VALUES ((SELECT ("id") FROM goods WHERE goods.name = 'latest good'), 5);
	
	IF ((SELECT SUM(warehouse1.good_count) FROM warehouse1) > 10) THEN
		ROLLBACK;
		-- RAISE EXCEPTION "Too much goods in warehouse 1";
	END IF;
	
	COMMIT;
END
$do$